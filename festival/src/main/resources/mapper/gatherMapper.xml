<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.teamproject.festival.gather.mapper.GatherMapper">

    <!-- 동행 리스트 추가 -->
    <insert id="gatherInsert" parameterType="com.teamproject.festival.gather.dto.GatherDto" useGeneratedKeys="true" keyProperty="gatherId" keyColumn="gather_id">
        INSERT INTO gather(gather_id, user_id, gt_title, prefer_gender, prefer_age)
        VALUES (#{gatherId}, #{userId}, #{gtTitle}, #{preferGender}, #{preferAge})
    </insert>

    <!-- 동행 리스트 이미지 추가 -->
    <insert id="gtImgInsert" parameterType="gatherImgDto">
        INSERT INTO gt_img(ft_id, gt_useYn)
        VALUES (#{ftId}, #{gtUseYn})
    </insert>

    <!-- 전체 목록 조회 -->
    <select id="gatherListAll" resultType="gatherDto">
        SELECT gather_id, gt_title, gt_rgDate, prefer_gender, prefer_age, gt_img, gt_count, user_id
        FROM gather
    </select>



    <!-- 축제 검색 -->
    <select id="gatherSelect" resultType="gatherDto">
        SELECT gt_title, gather_id, ft_id, gt_mtDate, prefer_gender, prefer_age
        FROM gather
        WHERE ft_id = #{ftId}
    </select>

    <!-- 축제 아이디에 맞는 이미지 검색 -->
    <select id="gatherImgSelect" resultType="gatherImgDto">
        SELECT gt_title, ft_id, gt_mtDate, prefer_gender, prefer_age
        FROM gather
        WHERE ft_id = #{ft_id}
        ORDER BY ft_id
    </select>



    <!-- 축제 변경하기 -->
    <update id="gatherUpdate" parameterType="gatherDto">
        UPDATE gather
        SET gt_title = #{gtTitle}, prefer_gender = #{preferGender}, prefer_age = #{preferAge}
        WHERE gather_id = #{gatherId}
    </update>

    <!-- 축제 이미지 변경하기 -->
    <update id="gatherImgUpdate" parameterType="gatherImgDto">
        UPDATE
        SET
        INSERT INTO gt_img(ft_id, gt_useYn)
        VALUES (#{ftId}, #{gtUseYn})
    </update>

    <!-- 검색어를 사용하여 검색하기 (?) -->
    <sql id="gatherSearchConditions">
        <if test="gatherSearchDto.searchBy != null and gatherSearchDto.searchText != ''">
            <choose>
                <when test="(gatherSearchDto.searchBy).equals('ftId')">
                    AND ft_id LIKE CONCAT('%', #{gatherSearchDto.searchText}, '%')
                </when>

                <when test="(gatherSearchDto.searchBy).equals('preferGender')">
                    AND prefer_gender LIKE CONCAT('%', #{gatherSearchDto.searchText}, '%')
                </when>

                <when test="(gatherSearchDto.searchBy).equals('preferAge')">
                    AND prefer_age LIKE CONCAT('%', #{gatherSearchDto.searchText}, '%')
                </when>
            </choose>
        </if>
    </sql>

</mapper>